
<!DOCTYPE html>
<html lang="ko" dir="ltr" class='com_virtuemart view-cart j35 mm-hover'>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="robots" content="NOINDEX, NOFOLLOW, NOARCHIVE, NOSNIPPET" />
<meta name="description" content="" />
<meta name="generator" content="" />
<title>장바구니</title>
<link rel="stylesheet" href="/css/css-9bc8a.css" type="text/css" />
<link rel="stylesheet" href="/css/css-80c6b.css" type="text/css" />
<link rel="stylesheet" href="/css/css-6df77.css" type="text/css" />
<link rel="stylesheet" href="/css/css-8b9e3.css" type="text/css" />
<link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="/css/ionicons.min.css">
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.min.css">
<link rel="stylesheet" type="text/css" href="/css/style1.css">

<script type="text/javascript" src="/js/jquery-1.10.1.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/js/ajax-loading.js"></script>
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script type="text/javascript" src="/js/jquery.number.min.js"></script>
<script type="text/javascript" src="/js/jquery.cookie.js"></script>
  
<!-- META FOR IOS & HANDHELD -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<meta name="HandheldFriendly" content="true"/>
<meta name="apple-mobile-web-app-capable" content="YES"/>
<!-- //META FOR IOS & HANDHELD -->
</head>

<body>
<div class="t3-wrapper">
	<!-- HEADER -->
<header id="t3-header" class="t3-header ">
<div class="container">
	<div class="row">
		<!-- LOGO -->
		<div class="col-sm-2 logo" style="padding-top:0;">
			<div class="logo-image" style="margin-top:0">
				<a href="/main/main.html" title="다이렉트 게임즈">
					<img class="logo-img" src="/images/common/dg_logo_new.png"  alt="다이렉트 게임즈">
					<span>다이렉트 게임즈</span>
				</a>
				<small class="site-slogan"></small>
			</div>
		</div>
		<!-- //LOGO -->

		<div class="col-sm-7 search" style="padding-top:0px;">
			<form class="search_form" id="header-search" method="get" action="/game/game_search.html">
				<div class="form-group">
					<div class="input-group" >
					  <input type="text" id="searchValue" name="searchValue" class="form-control input-lg ui-autocomplete-input" placeholder="" autocomplete="off" >
					  <div class="input-group-btn" >
						 <button class="btn btn-lg btn-search" style="border-top: 1px solid rgba(255,255,255,0.1);border-right: 1px solid rgba(255,255,255,0.1);border-bottom: 1px solid rgba(255,255,255,0.1);"><i class="fa fa-search"></i></button>
					  </div>
					</div>
				 </div>
			</form>
		</div>

		<div class="head-right col-sm-3" style="padding-top:10px;">
			<div class="head-cart">
				<a href="/order/v2/cart.html" class="btn btn-cart" type="button" id="head-cart-dropdown" style="color:#ffffff">
					<i class="fa fa-shopping-cart"></i>
				</a>
			</div>

			<div class="head-login">
								<a class="btn btn-default btn-sm" href="/member/logout.html">
					<i class="fa fa-unlock"></i> 로그아웃
				</a>
				<a class="btn btn-default btn-sm" href="/mypage/mypage_main.html"><i class="fa fa-user"></i> 마이페이지</a>
							</div>
		</div>
	</div>
</div>
</header>
<!-- //HEADER -->	<!-- MAIN NAVIGATION -->
<nav id="t3-mainnav" class="wrap navbar navbar-default t3-mainnav">
	<div class="container">
		<div class="t3-navbar navbar-collapse collapse">
			<div class="t3-megamenu animate elastic" data-duration="400" data-responsive="true">
				<ul itemscope="name" itemtype="http://www.schema.org/SiteNavigationElement" class="nav navbar-nav">
					<li itemprop="name" class="current active" data-id="101" data-level="1"><a itemprop="url" class="" href="/main/main.html" data-target="#">홈 </a></li>
					<li itemprop="name" data-id="151" data-level="1"><a itemprop="url" class="" href="/service/service.html" data-target="#">서비스소개</a></li>
					<li itemprop="name" class="mega" data-id="152" data-level="1"><a itemprop="url" class="" href="/game/game_thumb.html">게임</a></li>
					<li class="dropdown mega" data-id="156"><a class=" dropdown-toggle" href="/customer/notice.html" data-target="#" data-toggle="dropdown">고객지원<em class="caret"></em></a>
						<div class="nav-child dropdown-menu mega-dropdown-menu">
							<div class="mega-dropdown-inner">
								<div class="row">
									<div class="col-xs-12 mega-col-nav" data-width="12">
										<div class="mega-inner">
											<ul class="mega-nav level1">
												<li itemprop="name" data-id="202" data-level="1"><a itemprop="url" class="" href="/customer/notice.html" data-target="#" >공지사항 </a></li>
												<li itemprop="name" data-id="204" data-level="1"><a itemprop="url" class="" href="/customer/faq.html" data-target="#" >자주묻는질문 </a></li>
												<li data-id="205"><a class="" href="/customer/qna.html" data-target="#">문의하기 </a></li>
											</ul>
										</div>
									</div>
								</div>
							</div>
						</div>
					</li>
					<li itemprop="name" class="mega" data-id="301" data-level="1" ><a itemprop="url" href="/event/event.html">이벤트</a></li>
				</ul>
			</div>
		</div>
	</div>
</nav>
<!-- //MAIN NAVIGATION -->
	<div id="t3-mainbody" class="wrap t3-mainbody">
		<div class="container">
			<div class="row">
				<!-- MAIN CONTENT -->
				<div id="t3-content" class="t3-content col-xs-12">
					<div id="system-message-container"></div>

					<div id="cart-view" class="cart-view" style="padding-top:20px">
						<div class="vm-cart-header-container">
							<div class="width50 floatleft vm-cart-header">
								<h1 style="font-size:18px;font-weight:bold">장바구니</h1>
								<div class="payments-signin-button" ></div>
							</div>
							<div class="width50 floatleft right vm-continue-shopping">
								<a class="continue_link" href="http://directgames.co.kr/">계속 쇼핑하기</a></div>
							<div class="clear"></div>
						</div>
							

							
						<form method="post" id="cartFrm" name="cartFrm" action="cart_proc.php">
							<fieldset class="vm-fieldset-pricelist">
								<table class="cart-summary" cellspacing="0" cellpadding="0" border="0" width="100%">
								<tr>
									<th class="text-center" style="width:50px"><input type="checkbox" name="chk_all"  id="chk_all" value="Y"></th>
									<th class="vm-cart-item-image" style="width:150px">이미지</th>
									<th class="vm-cart-item-name">상품명</th>
									<th class="vm-cart-item-quantity">수량</th>
									<th class="vm-cart-item-basicprice" >가격</th>
									<th class="vm-cart-item-discount" ><span  class='priceColor2'>할인</span></th>
									<th class="vm-cart-item-total" >합계</th>
								</tr>

																<tr valign="top" class="sectiontableentry1">
									<td class="text-center"><input type="checkbox" name="goods_code[]" value="50001976"></td>
									<td>
										<span class="cart-images">
																				<img src="/upload/product/goods_1565338742_simg.jpg" width="144" height="81" style="width:144px;">
																				</span>
									</td>
									<td class="vm-cart-item-name" >
										<a href="/game/game_page.html?product_code=50001976">인디비지블</a>
										<div class="vm-customfield-cart">
											
										</div>
									</td>
									<td class="vm-cart-item-quantity" style="min-width:120px;">
										<div class="form-group input-group">
											<div class="col-sm-12">
												<select name="qty[]" class="form-control input-sm" data-goodscode="50001976" style="width:55px;">
																										<option value="1" selected>1</option>
																										<option value="2" >2</option>
																										<option value="3" >3</option>
																									</select>

											</div>
											 
											<button type="button" class="btn_ea_update" data="50001976" data-prodtp="1" data-assetid="1581" title="수량변경" style="margin-top:8px;">수량변경</button>
																					</div>
									</td>
									<td class="vm-cart-item-basicprice" >
										<div class="PricediscountedPriceWithoutTax vm-display vm-price-value">
											<span class="vm-price-desc"></span>
																							<span class="PricediscountedPriceWithoutTax consumer_price"><s><small>45,000 </small></s></span> <span class="currency">원</span><br/>
												<span class="PricediscountedPriceWithoutTax price">40,500</span> <span class="currency">원</span>

																						</div>
									</td>

									<td class="vm-cart-item-coupon" >
																					<!--<button type="button" class="btn btn-danger btn-xs btn_coupon" data-consumer="45000" data-price="40500" data-goodscode="50001976" data-num="0" data-toggle="modal" data-target="#couponModal" data-use="Y" style="visibility:show">내쿠폰함</button>-->
																			</td>
									<td class="vm-cart-item-discount" >
										<span class='priceColor2'>
											<div class="PricediscountAmount vm-nodisplay">
												<span class="vm-price-desc"></span>
												<span class="PricediscountAmount"></span>
											</div>
										</span>
										<input type="hidden" name="apply_sno[]" value="">
										<div class="coupon_info">
																					</div>
									</td>
									<td class="vm-cart-item-total">
										<div class="PricesalesPrice vm-display vm-price-value">
											<span class="vm-price-desc"></span>
											<span class="PricesalesPrice">40,500</span>
										</div>
									</td>
								</tr>
																<tr valign="top" class="sectiontableentry1">
									<td class="text-center"><input type="checkbox" name="goods_code[]" value="50001977"></td>
									<td>
										<span class="cart-images">
																				<img src="/upload/product/goods_1565586822_simg.jpg" width="144" height="81" style="width:144px;">
																				</span>
									</td>
									<td class="vm-cart-item-name" >
										<a href="/game/game_page.html?product_code=50001977">NBA 2K20</a>
										<div class="vm-customfield-cart">
											
										</div>
									</td>
									<td class="vm-cart-item-quantity" style="min-width:120px;">
										<div class="form-group input-group">
											<div class="col-sm-12">
												<select name="qty[]" class="form-control input-sm" data-goodscode="50001977" style="width:55px;">
																										<option value="1" selected>1</option>
																										<option value="2" >2</option>
																										<option value="3" >3</option>
																									</select>

											</div>
											 
											<button type="button" class="btn_ea_update" data="50001977" data-prodtp="1" data-assetid="1583" title="수량변경" style="margin-top:8px;">수량변경</button>
																					</div>
									</td>
									<td class="vm-cart-item-basicprice" >
										<div class="PricediscountedPriceWithoutTax vm-display vm-price-value">
											<span class="vm-price-desc"></span>
																							<span class="PricediscountedPriceWithoutTax consumer_price"><s><small>65,000 </small></s></span> <span class="currency">원</span><br/>
												<span class="PricediscountedPriceWithoutTax price">52,800</span> <span class="currency">원</span>

																						</div>
									</td>

									<td class="vm-cart-item-coupon" >
																					<!--<button type="button" class="btn btn-danger btn-xs btn_coupon" data-consumer="65000" data-price="52800" data-goodscode="50001977" data-num="1" data-toggle="modal" data-target="#couponModal" data-use="Y" style="visibility:show">내쿠폰함</button>-->
																			</td>
									<td class="vm-cart-item-discount" >
										<span class='priceColor2'>
											<div class="PricediscountAmount vm-nodisplay">
												<span class="vm-price-desc"></span>
												<span class="PricediscountAmount"></span>
											</div>
										</span>
										<input type="hidden" name="apply_sno[]" value="">
										<div class="coupon_info">
																					</div>
									</td>
									<td class="vm-cart-item-total">
										<div class="PricesalesPrice vm-display vm-price-value">
											<span class="vm-price-desc"></span>
											<span class="PricesalesPrice">52,800</span>
										</div>
									</td>
								</tr>
																								<tr>
									<td colspan="8">
										<button type="button" class="btn btn-default btn-sm" id="btn_all_delete">전체삭제</button> <button type="button" class="btn btn-default btn-sm" id="btn_select_delete">선택삭제</button>
									</td>
								</tr>
								<tr class="sectiontableentry2">
									<td colspan="4" align="right">합계:</td>
									<td align="right">
										<span  class='priceColor2'>
											<div class="PricebillTaxAmount vm-display vm-price-value">
												<span class="vm-price-desc"></span>
												<span class="PricebillTaxAmount"></span>
											</div>
										</span>
									</td>
									<td align="right"> <span  class='priceColor2'></span> </td>
									<td align="right"> <span  class='priceColor2'></span> </td>
									<td align="right">
										<strong>
											<div class="PricebillTotal vm-display vm-price-value">
												<span class="vm-price-desc"></span>
												<span class="PricebillTotal">93,300 원</span>
											</div>
										</strong>
									</td>
								</tr>
																</table>
							</fieldset>

							<div class="checkout-button-top">
								<button type="button" id="btn_order" name="checkout" class="btn btn-default btn-lg vm-button-correct" value="1" style="font-size:16px">주문하기</button>
							</div>
						</form>
				</div>
				<!-- //MAIN CONTENT -->
			</div>
		</div>
	</div>
	<!-- FOOTER -->
<footer id="t3-footer" class="wrap t3-footer" style="height:120px;padding-top:0;padding-bottom:0;">
	<div class="container" style="padding-top:0;padding-bottom:0">
		<div class="navbar-footer">
			<ul class="nav nav-pills" style="margin-top:10px;">
				<li><a href="*" target="_blank">회사소개</a></li>
				<li><a href="*">이용약관</a></li>
				<li><a href="*">개인정보처리방침</a></li>
				<li><a href="*" target="_blank">사업자정보확인</a></li>
				<li><a href="*">청소년보호정책</a></li>
				
			</ul>
		</div>
		<address style="padding-top:8px;padding-bottom:0">
			<p style="margin-bottom:0;">DIRECT GAMES <span class="bars">|</span> 소재지 <span class="bars">|</span> 대표이사 <span class="bars">|</span> 개인정보관리책임자 </p>
			<p style="margin-bottom:0;">사업자등록번호 <span class="bars">|</span> 통신판매업신고 <span class="bars">|</span> 고객센터  <span class="bars">|</span> 전자우편 </p>
		</address>
	</div>

	<section class="t3-copyright" style="padding-top:0px;padding-bottom:0;margin-top:-8px">
		<div class="container" style="padding-top:0;padding-bottom:0">
			<div class="row">
				<div class="col-md-12 copyright">
					<small>Copyright © DIRECT GAMES. All Rights Reserved. </small>
				</div>
			</div>
		</div>
	</section>
</footer>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44849781-2', 'auto');
  ga('send', 'pageview');

</script>
<!-- //FOOTER -->

<!-- 리포트2.0 로그분석코드 시작 -->
<script type="text/javascript">
var JsHost = (("https:" == document.location.protocol) ? "https://" : "http://");
var uname = escape("다이렉트게임즈");
document.write(unescape("%3Cscript id='log_script' src='" + JsHost + "h2intershop.weblog.cafe24.com/weblog.js?uid=h2intershop&uname="+uname+"' type='text/javascript'%3E%3C/script%3E"));
</script>
<!-- 리포트2.0  로그분석코드 완료 --></div>

<div class="modal" id="couponModal" tabindex="-1" role="dialog" aria-labelledby="couponModalLabel" aria-hidden="hidden">
	<div class="modal-dialog">
		<div class="modal-content" style="min-width:650px">
			<div class="modal-body">
				<form class="form-horizontal" name="modalFrm" id="modalFrm">
				<input type="hidden" class="form-control" name="coupon_goods_code" id="coupon_goods_code" value="">				<input type="hidden" class="form-control" name="num" id="num"  value="">				<dl>
					<dt style="display:inline;padding-right:40px;">- 판매자할인</dt>
					<dd style="display:inline"><span id="customer_sale"></span></dd>
				</dl>
				</form>
				<div class="row total">
					<div class="col-md-3">
						<div class="text-center price_origin"> 
							<span class="tit">상품금액</span> 
							<strong id="consumer_price_value"></strong><span class="currency">원</span> 
						</div> 
					</div>
					<div class="col-md-1">
						<span style="font-size:20px;font-weight:900">-</span> 
					</div>
					<div class="col-md-3">
						<div class="text-center price_sale"> 
							<span class="tit">할인금액</span> 
							<strong id="sale_price_value"></strong>
							<span class="currency ng-scope">원</span> 
						</div> 
					</div>
					<div class="col-md-1">
						<span class="equal" style="font-size:20px;font-weight:900">=</span> 
					</div>
					<div class="col-md-4">
						<div class="text-center price_total"> 
							<span class="tit">결제 예정금액</span> 
							<strong id="price_total_value"></strong>
							<span class="currency">원</span> 
						</div> 
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
$(document).ready(function(){
	//$('#cart_sale_content').popover('hide');

	$("#chk_all").bind("click",function(){
		if($("#chk_all:checked").val()=="Y"){
			$('input[name="goods_code[]"]').prop("checked",true);
		}else{
			$('input[name="goods_code[]"]').prop("checked",false);
		}
	});

	$(".btn_cart_delete").bind("click",function(){
		var index = $(".btn_cart_delete").index(this);
		var goods_code = $(".btn_cart_delete").eq(index).attr("data");
		var mode = "cartDelete";
		var formURL = "/order/cart_proc.php";

		if(confirm("해당상품을 삭제하시겠습니까?")){
			$.ajax({
				  url : formURL,
				  type: "POST",
				  data : {goods_code:goods_code,mode:mode},
				  success:function(data){
						//$(".btn_cart_delete").eq(index).parent().parent().remove();
						alert(data);
				  },
				  error: function(jqXHR, textStatus, errorThrown) {
						alert(data);
				  }
			 });
		 }
	});

	//장바구니 전체삭제
	$("#btn_all_delete").bind("click",function(){
		var goods_code = new Array();

		var i=0 ;
		$("input[name='goods_code[]']:checked").each(function(){
			goods_code[i] = $("input[name='goods_code[]']:checked").eq(i).val();
			i++;
		});

		var mode = "allDelete";
		var formURL = "/order/cart_proc.php";
		$.ajax({
			  url : formURL,
			  type: "POST",
			  data : {goods_code:goods_code,mode:mode},
			  success:function(data, textStatus, jqXHR){
					location.reload();
			  },
			  error: function(jqXHR, textStatus, errorThrown) {
					alert(jqXHR);
			  }
		 });
	});

	//장바구니 선택삭제
	$("#btn_select_delete").bind("click",function(){
		var goods_code = new Array();

		var i=0 ;
		$("input[name='goods_code[]']:checked").each(function(){
			goods_code[i] = $("input[name='goods_code[]']:checked").eq(i).val();
			i++;
		});

		var mode = "selectDelete";
		var formURL = "/order/cart_proc.php";
		$.ajax({
			  url : formURL,
			  type: "POST",
			  data : {goods_code:goods_code,mode:mode},
			  success:function(data, textStatus, jqXHR){
					location.reload();
			  },
			  error: function(jqXHR, textStatus, errorThrown) {
					alert(jqXHR);
			  }
		 });
	});

	//장바구니 수량변경
	$(".btn_ea_update").bind("click",function(){
		var index = $(".btn_ea_update").index(this);
		var goods_code = $(".btn_ea_update").eq(index).attr("data");
		var prod_tp = $(".btn_ea_update").eq(index).attr("data-prodtp");
		var asset_id = $(".btn_ea_update").eq(index).attr("data-assetid");
		var coupon_use = $(".btn_ea_update").eq(index).attr("data-coupon");
		var ea = $("select[name='qty[]'] option:selected").eq(index).val();
		var mode = "modCart";
		var formURL = "/order/cart_proc.php";

		if(coupon_use=="use"){
			alert("쿠폰 적용 취소 후 수량변경이 가능합니다.");
			$("select[name='qty[]']").eq(index).val("1");
			return false;
		}else{
			$.ajax({
				  url : formURL,
				  type: "POST",
				  dataType:'JSON',
				  data : {goods_code:goods_code,ea:ea,mode:mode,prod_tp:prod_tp,asset_id:asset_id},
				  success:function(data){
						console.log(data);
						if(data['error_code']=="0"){
							alert("수량이 변경되었습니다.");
							location.reload();
						}else{
							alert(data['error_msg']);
							location.reload();
						}
						
				  },
				  error: function(jqXHR, textStatus, errorThrown) {
						alert(jqXHR);
				  }
			 });
		}
	});

	//주문하기
	$("#btn_order").bind("click",function(){
		if($("input[name='goods_code[]']:checked").length==0){
			alert("주문하실 상품은 선택해 주세요.");
			return false;
		}

		$("#cartFrm").attr("action","order.html");
		$("#cartFrm").submit();
	});

	//쿠폰사용 선택
	$('input[name="coupon_apply_sno"]').bind("click",function(){
		var coupon = Number($('input[name="coupon_apply_sno"]:checked').attr("data-coupon"));
		var currency = $('input[name="coupon_apply_sno"]:checked').attr("data-currency");
		var coupon_price = 0;
		var consumer_price =  Number($("#consumer_price_value").attr("data-origin").replace(",",""));
		var sale_price = Number($("#sale_price_value").attr("data-origin").replace(",",""));
		var price_total = Number($("#price_total_value").attr("data-origin").replace(",",""));

		if(currency=="%"){
			coupon_price = consumer_price * coupon /100;
		}else{
			coupon_price = coupon;
		}

		$('#sale_price_value').text($.number(sale_price+coupon_price));
		$('#price_total_value').text($.number(price_total-coupon_price));
	});

	//쿠폰사용 적용
	$("#btn_modal_coupon_apply").bind("click",function(){
		var num = $("#couponModal input[name='num']").val();
		var coupon_apply_sno = $('#couponModal input[name="coupon_apply_sno"]:checked').val();
		var sale_price = $("#couponModal #sale_price_value").text();
		var total = $("#couponModal #price_total_value").text();
		var goods_code = $('#couponModal #coupon_goods_code').val();

		if(typeof(coupon_apply_sno) !== 'undefined' ){
			$(".price").eq(num).text(total);
			$('input[name="apply_sno[]"]').eq(num).val(coupon_apply_sno);
			
			$("#couponModal input[name='coupon_apply_sno']:radio[value='"+coupon_apply_sno+"']").attr("disabled",true);
			
			$("#couponModal input[name='coupon_apply_sno']:radio[value='"+coupon_apply_sno+"']").parent().parent().append("<span class='label label-danger' id='coupon_status"+coupon_apply_sno+"'>사용중</span>");
			$("#couponModal input[name='coupon_apply_sno']:radio[value='"+coupon_apply_sno+"']").attr("checked",false);
			
			$.ajax({
				url:"cart_proc.php",
				type:"POST",
				data:{mode:"setCartCoupon",goods_code:goods_code,coupon_apply_sno:coupon_apply_sno},
				success:function(data){
					$(".btn_coupon").eq(num).hide();
					$(".coupon_info").eq(num).html("<span class='label label-primary btn_coupon_cancel' data-num="+num+">적용취소</span>");
					$('#couponModal').modal('hide');
					$(".btn_ea_update").eq(num).attr("data-coupon","use");
					
				},
				error:function(data){
					alert("처리오류");
				}
			});
		}else{
			alert("사용할 쿠폰을 선택하세요.");
		}
	});

	$("#btn_modal_coupon_cancel").bind("click",function(){
		$('#couponModal').modal('hide');
		$('.modal-backdrop').addClass("fade");
	});

	function total_sale_price(){
		var total_price = 0;
		var total_consumer = 0;

		for(var i=0;i<$(".price").length;i++){
			total_price += Number($(".price").eq(i).text().replace(",",""));
			total_consumer += Number($(".consumer_price").eq(i).text().replace(",",""));
		}

		$("#cart_total_sale_value").text($.number(total_consumer-total_price));
		$("#total_value").text($.number(total_price));
	}

	//쿠폰적용 취소(비동기)
	$(document).on("click",".btn_coupon_cancel",function(){
		var num = $(this).data("num");	//  장바구니 인덱스번호
		var coupon_no = $('input[name="apply_sno[]"]').eq(num).val();	//적용된 쿠폰번호
		var goods_code = $(this).data("goodscode");

		$.ajax({
			url:"cart_proc.php",
			type:"POST",
			data:{mode:"delCartCoupon",goods_code:goods_code},
			success:function(data){
				location.reload();
			},
			error:function(data){
				alert("처리오류");
			}
		});
	});

	//쿠폰적용 취소(동기)
	$('.btn_coupon_cancel').bind("click",function(){
		var num = $(this).data("num");	//  장바구니 인덱스번호
		var coupon_no = $('input[name="apply_sno[]"]').eq(num).val();	//적용된 쿠폰번호
		var goods_code = $(this).data("goodscode");

		$.ajax({
			url:"cart_proc.php",
			type:"POST",
			data:{mode:"delCartCoupon",goods_code:goods_code},
			success:function(data){
				location.reload();
			},
			error:function(data){
				alert("처리오류");
			}
		});
	});
});


window.onload = function(){
	//로딩시 체크
	$("input[name='apply_sno[]']").each(function(i){
			var chk = "";
		if($("input[name='apply_sno[]']").eq(i).val()>0){
			chk = $("input[name='apply_sno[]']").eq(i).val();
			$("input[name='coupon_apply_sno']:radio[value='"+chk+"']").attr('disabled', true);
			$("input[name='coupon_apply_sno']:radio[value='"+chk+"']").parent().parent().append("<span class='label label-danger' id='coupon_status"+chk+"'>사용중</span>");
			$("input[name='coupon_apply_sno']:radio[value='"+chk+"']").attr("checked",false);
		}
	});
};

	$('#couponModal').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var goods_code = button.data('goodscode');
  var consumer_price = button.data('consumer') // Extract info from data-* attributes
  var price = button.data('price');
  var coupon_use = button.data('use');
  var num = button.data('num');
  var modal = $(this);

  if(coupon_use=="N"){
		alert("해당제품은 이벤트 진행상품이므로 쿠폰할인이 불가능합니다.");
		$('#couponModal').modal('hide');
		return false;
  }else{
	
		modal.find('#consumer_price_value').text($.number(consumer_price));
		modal.find('#sale_price_value').text($.number(consumer_price-price));
		modal.find('#price_total_value').text($.number(price));

		modal.find('#coupon_goods_code').val(goods_code);
		modal.find('#num').val(num);

		modal.find('#consumer_price_value').attr("data-origin",consumer_price);
		modal.find('#sale_price_value').attr("data-origin",consumer_price-price);
		modal.find('#customer_sale').text($.number(consumer_price-price)+" 원");
		
		modal.find('#price_total_value').attr("data-origin",price);
		$('#couponModal').modal('hide');
		$('.modal-backdrop').addClass("fade");
		
		//$('#couponModal input[name="coupon_apply_sno"]:checked').attr("disabled",true);
			
		//$('#couponModal input[name="coupon_apply_sno"]:checked').parent().parent().append("<span class='label label-danger' id='coupon_status"+coupon_apply_sno+"'>사용중</span>");
		//$('#couponModal input[name="coupon_apply_sno"]:checked').attr("checked",false);
	}
	
});

</script>
</body>
</html>
